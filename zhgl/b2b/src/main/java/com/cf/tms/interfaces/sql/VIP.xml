<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="VIP" >
	<!--查询服务套餐列表  -->
	<select id="selectVIPBILL" parameterType="map" resultType="map">
		select a.order_mailno "billno",to_char(a.order_insert_time,'YYYY-MM-DD') "postdate",
			    a.sendlist_id "ddh",
			    (select b.code from tms.area_tab b where b.name3=a.sender_city) "postzone",
			    (select b.net_code from tms.area_tab b where b.name3=a.sender_city) "postnet",
			    a.sender_city "postzone_cn",a.sender_name "postman",a.sender_company "postdw",
			    NVL(REPLACE(a.sender_mobile,'null',''),' ')||';'||NVL(REPLACE(a.sender_phone,'null',''),' ') "posttel",REPLACE(a.sender_address,'?','') "postaddr",
			    (select b.code from tms.area_tab b where b.name3=a.receiver_city) "acceptzone",
			    (select b.net_code from tms.area_tab b where b.name3=a.receiver_city) "acceptnet",
			    a.receiver_city "acceptzone_cn",REPLACE(a.receiver_name,'?','') "acceptman",a.receiver_company "acceptdw",
			    NVL(REPLACE(a.receiver_mobile,'null',''),' ')||';'||NVL(REPLACE(a.receiver_phone,'null',''),' ') "accepttel",REPLACE(a.receiver_address,'?','') "acceptaddr",
			    a.order_quantity "boxes",a.order_pairs "duals",a.order_bulk "volume",NVL(REPLACE(a.order_remark,'null',''),' ') "memo",a.order_weight "weight",
			    (select b.v8_customer_name from cf_customer b where b.customer_id = a.customer_id) "cus_code",
			    (select c.jswd from cf_customer b,cust_tab c where b.customer_id = a.customer_id and b.v8_customer_name=c.cus_code) "jswd",
			    (select c.jjfs from cf_customer b,cust_tab c where b.customer_id = a.customer_id and b.v8_customer_name=c.cus_code) "jjfs",
			    (select c.gg from cf_customer b,cust_tab c where b.customer_id = a.customer_id and b.v8_customer_name=c.cus_code) "gg",
			    (case when a.order_paymode='sender_prompt' then '1'
			      when a.order_paymode='receiver_prompt' then '2'
			      else '3' end) "fkfs",
			    (case when a.order_paymode='sender_prompt' then '现金'
			      when a.order_paymode='receiver_prompt' then '到付'
			      else '月结' end) "fkfs_cn",
			    NVL((select b.code from tms.hwlb_tab b where a.order_goods = b.name),1) "hwlb",
			    a.order_goods "hwlb_cn",a.order_freight "postfee",
			    a.order_premium "bjfee",a.order_sum "totalprice",
			    (select (case when count(*) =1 then '是' else '否' end) from cfcus_order_tab c where a.order_mailno = c.billno) "ytb",
			    (select count(*) from cfcus_order_tab c where a.order_mailno = c.billno) "tbbj", 0 "pdbj"
	    from cfcus_order a
	    where a.order_status!='cancel'
		<if test="ddh != '' and ddh != null">AND a.sendlist_id=#{ddh}</if>
		<if test="billno != '' and billno != null">
			and 
			<foreach item="item" index="index" collection="billno"   
	                         open="(" separator="or" close=")">                           
	                        a.order_mailno= #{item}  
	         </foreach>
		</if>
 	</select>
 		<select id="selectVIPBILL_DP" parameterType="map" resultType="map">
		select a.order_mailno "billno",to_char(a.order_insert_time,'YYYY-MM-DD') "postdate",
			    a.sendlist_id "ddh",
			    (select b.code from tms.area_tab b where b.name3=a.sender_city) "postzone",
			    (select b.net_code from tms.area_tab b where b.name3=a.sender_city) "postnet",
			    a.sender_city "postzone_cn",a.sender_name "postman",a.sender_company "postdw",
			    NVL(REPLACE(a.sender_mobile,'null',''),' ')||';'||NVL(REPLACE(a.sender_phone,'null',''),' ') "posttel",REPLACE(a.sender_address,'?','') "postaddr",
			    (select b.code from tms.area_tab b where b.name3=a.receiver_city) "acceptzone",
			    (select b.net_code from tms.area_tab b where b.name3=a.receiver_city) "acceptnet",
			    a.receiver_city "acceptzone_cn",REPLACE(a.receiver_name,'?','') "acceptman",a.receiver_company "acceptdw",
			    NVL(REPLACE(a.receiver_mobile,'null',''),' ')||';'||NVL(REPLACE(a.receiver_phone,'null',''),' ') "accepttel",REPLACE(a.receiver_address,'?','') "acceptaddr",
			    a.order_quantity "boxes",a.order_pairs "duals",a.order_bulk "volume",NVL(REPLACE(a.order_remark,'null',''),' ') "memo",a.order_weight "weight",
			    (select b.v8_customer_name from cf_customer b where b.customer_id = a.customer_id) "cus_code",
			    (select c.jswd from cf_customer b,cust_tab c where b.customer_id = a.customer_id and b.v8_customer_name=c.cus_code) "jswd",
			    (select c.jjfs from cf_customer b,cust_tab c where b.customer_id = a.customer_id and b.v8_customer_name=c.cus_code) "jjfs",
			    (select c.gg from cf_customer b,cust_tab c where b.customer_id = a.customer_id and b.v8_customer_name=c.cus_code) "gg",
			    (case when a.order_paymode='sender_prompt' then '1'
			      when a.order_paymode='receiver_prompt' then '2'
			      else '3' end) "fkfs",
			    (case when a.order_paymode='sender_prompt' then '现金'
			      when a.order_paymode='receiver_prompt' then '到付'
			      else '月结' end) "fkfs_cn",
			    NVL((select b.code from tms.hwlb_tab b where a.order_goods = b.name),1) "hwlb",
			    a.order_goods "hwlb_cn",a.order_freight "postfee",
			    a.order_premium "bjfee",a.order_sum "totalprice",
			    (select (case when count(*) =1 then '是' else '否' end) from cfcus_order_tab c where a.order_mailno = c.billno) "ytb",
			    (select count(*) from cfcus_order_tab c where a.order_mailno = c.billno) "tbbj", 0 "pdbj"
	    from cfcus_order a
	    where a.order_status!='cancel'
		<if test="ddh != '' and ddh != null">AND a.sendlist_id=#{ddh}</if>
		<if test="billno != '' and billno != null">AND a.order_mailno=#{billno} </if>
 	</select>
</mapper>