<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="CX">
  <select id="queryMENUALQX" parameterType="Map" resultType="java.util.Map">
  	select cd,alqx from user_cdqx where person_id=#{CFRY01}
  </select>
  
  <select id="queryWDQX" parameterType="Map" resultType="java.util.Map">
  	select net_code WD01  from user_net_table where peop_code=#{CFRY01}
  </select>
  
  
  
  <select id="queryBM" parameterType="Map" resultType="string">
  	SELECT B.BM01 
	  FROM W_RYSJQX A,W_SJQXBM B
	 WHERE A.SJ01 = B.SJ01 
	   AND A.CZY01 = #{RYBH}
  </select>
  
  <select id="queryCZY" parameterType="Map" resultType="java.util.Map">
  	<!-- select userid, username, passwd, khgsid, gsid, flag, roleid,  login_sessionid
		from user_info
	where flag =1 and userid = #{CFRY01} -->
  	SELECT A.userid ,A.username ,a.khgsid,a.gsid,
  	b.khgsname,b.khnamejc,
  	(select gsname from gs where gsid=a.gsid and flag=1) gsname,b.sjkhgsid,
    b.khgsroleid,
    (select rolename from dy_role where roleid=b.khgsroleid and gsid=a.gsid)rolename,
    (select khgsname from khgs where khgsid=b.sjkhgsid)sjkhname,
    (select khnamejc from khgs where khgsid=b.sjkhgsid)sjkhnamejc
  	  FROM user_info A,khgs b where A.gsid = B.gsid 
	  AND a.khgsid= b.khgsid
 	  AND A.flag =1 and A.userid=#{CFRY01}
  </select>
  
  
  <select id="queryGROUP" parameterType="Map" resultType="string">
  	select groupid from profile_user_group where userid=#{CFRY01}
  </select>
  
  <select id="queryMENU" parameterType="Map" resultType="java.util.Map">
	 SELECT B.LX01,B.LX02,A.GZL01,A.GZL02,C.BZ01
	    FROM W_GZL A,W_GZLLX B,W_GZLBZ C
	   WHERE A.LX01 = B.LX01
	     AND A.GZL01 = C.GZL01  
	     AND A.GZL03 = 0 
	     AND B.LX06 = 0
	     AND C.BZ03 = 1
	     AND C.BZ04 = 0
	     AND EXISTS (SELECT E.GW01
	                   FROM W_BZGW E,W_CZYGW F
	                  WHERE E.GW01 = F.GW01
	                    AND E.BZ01 = C.BZ01
	                    AND F.CZY01 = #{RYBH})
	   ORDER BY A.GZL04 ASC
  </select>
  
  <resultMap type="java.util.Map" id="result_queryDBSL">
	 <result property="XMBH" column="XMBH"/>
	 <result property="GZLBH" column="GZLBH"/>
	 <result property="GZLMC" column="GZLMC"/>
	 <result property="NUM" column="NUM"/>
  </resultMap>
  <select id="queryDBSL" parameterType="Map" resultMap="result_queryDBSL">
	  SELECT A.GZL01,A.GZL02,COUNT(1) NUM
   	    FROM W_GZL A,W_TASK B
       WHERE A.GZL01 = B.GZL01  
         AND A.GZL03 = 0
         AND EXISTS (SELECT E.GW01 
                        FROM W_BZGW E,W_GZLBZ F,W_CZYGW H
                       WHERE E.BZ01 = F.BZ01
                         AND E.GW01 = H.GW01
                         AND F.GZL01 = A.GZL01
                         AND E.BZ01 = B.BZ01
                         AND H.CZY01 = #{RYBH})
         AND ((B.SK05 = 0) OR ((B.SK05 = 1) AND EXISTS (SELECT E.SK01 
                                                          FROM W_TASKRY E 
                                                         WHERE E.SK01 = B.SK01 
                                                           AND E.CZY01 = #{RYBH}))) 
         <if test="BM != null">
         	<foreach collection="BM" index="index" item="bm01" open="AND ( " separator="or" close=")">
     		  	B.BM01 like  #{bm01}||'%'
   	     	</foreach> 
   	     </if>
       GROUP BY A.GZL01,A.GZL02
  </select>
  
  <resultMap type="java.util.Map" id="result_queryDBSL_CC">
	 <result property="XMBH" column="XMBH"/>
	 <result property="GZLBH" column="GZLBH"/>
	 <result property="GZLMC" column="GZLMC"/>
	 <result property="NUM" column="NUM"/>
  </resultMap>
  <select id="queryDBSL_CC" parameterType="Map" resultMap="result_queryDBSL_CC">
	  SELECT A.GZL01,A.GZL02,COUNT(1) NUM
   	    FROM W_GZL A,W_LOG B,W_CC C
       WHERE A.GZL01 = B.GZL01 
         AND B.SK01 = C.SK01 
         AND A.GZL03 = 0
         AND NOT EXISTS (SELECT E.CZY01 FROM W_CCHF E WHERE E.SK01 = B.SK01 AND E.CZY01 = #{RYBH})
 		 AND (C.CZY01 = #{RYBH}
 		  OR EXISTS (SELECT E.GW01 FROM W_CZYGW E WHERE E.GW01 = C.GW01 AND E.CZY01 = #{RYBH})) 
       GROUP BY A.GZL01,A.GZL02
  </select>
	 
  <!-- 通过业务系统传递的单据类型，查询对应项目编号 -->
  <select id="queryJK" parameterType="Map" resultType="java.lang.String">
	SELECT DISTINCT A.GZL01 FROM W_GZLXW A,W_JK B 
	 WHERE A.JK01 = B.JK01
	<if test="TBLNAME != null">
       AND TBLNAME=#{TBLNAME}
    </if>
  </select>
  
  <!-- 查询代办事宜 -->
  <select id="queryDBSY" parameterType="Map" resultType="java.util.Map">
	SELECT A.PID,A.SK01,A.GZL01,A.BM01,A.BZ01,A.TJCZY01,A.TJRYMC,A.GZL02,B.BZ02,
           to_char(A.SK04,'yyyy-MM-dd HH24:MI:SS') SK04,A.SK02,A.SK03,A.GSXX01,
           C.TBLNAME,C.JLBH
  	  FROM W_TASK A,W_GZLBZ B,W_TASKYWGL C
 	 WHERE A.BZ01 = B.BZ01
 	   AND A.PID = C.PID
 	 <if test="GZL01 != null"> 
 	   AND A.GZL01 = #{GZL01} 
 	 </if>
 	 <if test="CXTJ != null"> 
 	    AND (A.SK02 LIKE '%${CXTJ}%' 
 	    	OR A.SK03  LIKE '%${CXTJ}%'
 	    	OR A.GZL02  LIKE '%${CXTJ}%'  
 	    	OR A.BZ02  LIKE '%${CXTJ}%' 
 	    	OR A.TJRYMC  LIKE '%${CXTJ}%'
 			OR TO_CHAR(A.SK04, 'yyyy-MM-dd HH24:MI:SS')  LIKE '%${CXTJ}%')
 	 </if>
 	   AND EXISTS (SELECT E.GW01 
                     FROM W_BZGW E,W_GZLBZ F,W_CZYGW H
                    WHERE E.BZ01 = F.BZ01
                      AND E.GW01 = H.GW01
                      AND F.GZL01 = A.GZL01
                      AND E.BZ01 = B.BZ01
                      AND H.CZY01 = #{RYBH})
       AND ((A.SK05 = 0) OR ((A.SK05 = 1) AND EXISTS (SELECT E.SK01 
                                                        FROM W_TASKRY E 
                                                       WHERE E.SK01 = A.SK01 
                                                         AND E.CZY01 = #{RYBH})))
     <if test="BM != null">
	     <foreach collection="BM" index="index" item="bm01" open="AND ( " separator="or" close=")">
	    		  A.BM01 like  #{bm01}||'%'
		 </foreach> 
     </if>                                                      
 	 ORDER BY A.SK04 DESC
  </select>

	<!-- 获取抄送消息 -->
	<select id="queryDBSY_CC" parameterType="Map" resultType="java.util.Map">
		SELECT A.PID,A.SK01,A.GZL01,A.BM01,A.TJCZY01,A.TJRYMC,A.GZL02,
               to_char(A.SK04,'yyyy-MM-dd HH24:MI:SS') SK04,A.SK02,A.SK03,A.GSXX01,
               C.BDBH,C.JLBH,C.HFID_CC,D.TBLNAME,D.JLBH,
               (SELECT E.NBZ01 FROM W_GZLXW E 
                 WHERE E.XW01 = A.XW01
                   AND E.GZL01 = B.GZL01
                   AND E.BZ01 = B.BZ01) BZ01
  		  FROM W_LOG A,W_GZLBZ B,W_CC C,W_TASKYWGL D
 		 WHERE A.BZ01 = B.BZ01
 		   AND A.SK01 = C.SK01 
 		   AND A.PID = D.PID
 		   AND C.CC02 = 0
 		   AND NOT EXISTS (SELECT E.CZY01 FROM W_CCHF E WHERE E.SK01 = A.SK01 AND E.CZY01 = #{RYBH})
 		   AND (C.CZY01 = #{RYBH}
 		    OR EXISTS (SELECT E.GW01 FROM W_CZYGW E WHERE E.GW01 = C.GW01 AND E.CZY01 = #{RYBH}))
 		    <if test="GZL01 != null"> 
 	   			AND B.GZL01 = #{GZL01} 
 	 		</if>
 		 ORDER BY A.SK04 DESC
	</select> 
	
    <select id="queryXW" parameterType="Map" resultType="java.util.Map">
	  SELECT DISTINCT A.GZL01,A.BZ01,A.XW01,A.XW02,B.JK03,
	         B.TBLNAME, A.HFID
        FROM W_GZLXW A,W_JK B
       WHERE A.JK01 = B.JK01 
         AND A.GZL01=#{GZL01} 
         AND A.BZ01=#{BZ01} 
      <if test="XW01 != null">
         AND A.XW01 =#{XW01}
      </if>
    </select>
    
    <!-- 查询隐藏数据 -->
  	<select id="queryHDAT" parameterType="Map" resultType="java.lang.String">
		SELECT A.HDAT
		  FROM W_GZLXW A 
		 WHERE A.GZL01=#{GZL01} 
		   AND A.BZ01=#{BZ01} 
		   AND A.XW01=#{XW01}
  	</select>
  	
  	<!-- 查询抄送隐藏数据 -->
  	<select id="queryHDAT_CC" parameterType="Map" resultType="java.lang.String">
		SELECT A.HDAT_CC
		  FROM W_CC A
		 WHERE A.CZY01=#{CZY01} 
		   AND A.SK01=#{SK01}  
  	</select>
  	
  	<!-- 查询回退步骤 -->
  	<select id="queryHTBZ" parameterType="Map" resultType="java.util.Map">
		SELECT A.BZ01 KEY,A.BZ02 VALUE
  		  FROM (SELECT A.BZ01,A.BZ02,MAX(A.LOG02) LOG02
          		  FROM W_LOG A
         		 WHERE A.PID = #{PID} 
         		   AND A.SK01 != #{SK01}  
         		 GROUP BY A.BZ01,A.BZ02) A
 		 ORDER BY A.LOG02 DESC
  	</select>
  	
  	<!-- 查询抄送人员 -->
  	<select id="queryCSRY" parameterType="Map" resultType="java.util.Map">
		SELECT A.CZY01 KEY,A.CZY03 VALUE
          FROM W_CZY A
         WHERE A.CZY07 = 0
         <if test="BM01 != null">
           AND A.BM01 = #{BM01}
         </if>
  	</select>
  	
  	<!-- 查询抄送岗位-->
  	<select id="queryCSGW" parameterType="Map" resultType="java.util.Map">
		SELECT A.GW01 KEY,A.GW02 VALUE
          FROM W_GW A
         WHERE A.GW03 = 0 
  	</select>
  	
  	<select id="queryEXECL" parameterType="Map" resultType="java.util.Map">
		select a.jlbh "jlbh",a.key "key",a.mainkeys "mainkeys",a.detail "detail",a.mainsheet "mainsheet",a.form "form",a.reg "reg" from execl a where a.jlbh=#{jlbh}
  	</select>

	<select id="queryKHGS" marameterType="Map" resultType="java.util.Map">
		
	</select>
</mapper>