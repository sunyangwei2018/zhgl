<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="CFSTASK" >
	<!--查询服务套餐列表  -->
	<select id="selectSRCTASK" parameterType="map" resultType="map">
        select a.taskno as "taskno",NVL(a.car_num,' ') as "car_num",a.c_long as "c_long",a.c_height as "c_height",a.c_volume as "c_volume",a.c_width as "c_width",a.driver as "driver",a.tel as "tel",a.tsh_peop as "tsh_peop",a.shp_code as "shp_code",a.line_code as "line_code",a.memo as "memo",
      	a.yw_flag as "yw_flag",to_char(a.lrrq,'yyyy-MM-dd HH24:mi:ss') as "lrrq",a.net_code as "net_code",a.dd_flag as "dd_flag",a.state as "state",a.flag as "flag",a.lrr as "lrr",a.xgr as "xgr",to_char(a.xgrq,'yyyy-MM-dd HH24:mi:ss') as "xgrq" ,a.lscar_num as "lscar_num",
      	(select b.shp_name from shipper_tab b where b.shp_code=a.shp_code) as "shp_name",
    	(select c.line_name from line_tab c where c.line_code=a.line_code)as "line_name" ,
    	(select d.net_name from net_tab d where d.net_code=a.net_code) as "net_name",
    	(select e.peop_name from peop_tab e where e.peop_code=a.lrr) as "lrr_name",
    	(select f.peop_name from peop_tab f where f.peop_code=a.xgr) as "xgr_name",
    	(select g.name from ywlx_tab g where g.code=a.yw_flag) as "ywlx_name",
    	(select h.name from cllx_tab h where h.code=a.flag) as "cllx_name",
   		(select i.name from taskzt_tab i where i.code=a.state) as "state_cn",
   		(case when dd_flag=0 then '提送调度'
    	when dd_flag=1 then '发货调度'
   		END) as "dd_flag_cn",a.tsh_peop_code "tsh_peop_code"
    	from task_tab a
		where 1=1
		<if test="WD01 != '9000'">and a.net_code=#{WD01} </if>
		<if test="lrrq_S != '' and lrrq_S != null">AND a.lrrq&gt;=TO_DATE(#{lrrq_S},'yyyy-MM-dd HH24:mi:ss') </if>
	    <if test="lrrq_E != '' and lrrq_E != null">AND a.lrrq&lt;=TO_DATE(#{lrrq_E},'yyyy-MM-dd HH24:mi:ss') </if> 
		<if test="taskno != '' and taskno != null">
			and 
			<foreach item="item" index="index" collection="taskno"   
	                         open="(" separator="or" close=")">                           
	                        a.taskno= #{item}  
	         </foreach>
		</if>
		<if test="driver != '' and driver != null">AND a.driver=#{driver}</if>
		<if test="dd_flag != '' and dd_flag != null">AND a.dd_flag=#{dd_flag}</if>
		<if test="line_code != '' and line_code != null">AND a.line_code=#{line_code}</if>
		<if test="car_num != '' and car_num != null">
		AND ((a.car_num LIKE CONCAT(CONCAT('%', #{car_num}), '%')) OR (a.lscar_num LIKE CONCAT(CONCAT('%', #{car_num}), '%')))</if>
		<if test="yw_flag != '' and yw_flag != null">AND a.yw_flag=#{yw_flag}</if>
		<if test="shp_code != '' and shp_code != null">AND a.shp_code=#{shp_code}</if>
		<if test="state != '' and state != null">AND a.state=#{state}</if>
		<if test="nownet != '' and nownet != null">AND a.nownet=#{nownet}</if>
		<if test="net_code != '' and net_code != null">AND a.net_code=#{net_code}</if>
	</select>
	<select id="selectPEOP" parameterType="map" resultType="map">
    	select a.peop_code "peop_code",a.peop_name "peop_name"
   		from peop_tab a
		where 1 = 1
		<if test="peop_name != '' and peop_name != null">AND a.peop_name LIKE CONCAT(CONCAT('%', #{peop_name}), '%')</if>
		<if test="net_code != '' and net_code != null">AND a.net_code =#{net_code}</if>
 	</select>
</mapper>