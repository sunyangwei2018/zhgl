<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="CFTASK" >
	<!--查询服务套餐列表  -->
	<select id="selectTASK" parameterType="map" resultType="map">
    	select a.taskno "taskno",a.car_num "car_num",a.c_long "c_long",a.c_height "c_height",a.c_volume "c_volume",a.c_width "c_width",a.driver "driver",a.tel "tel",a.tsh_peop "tsh_peop",a.shp_code "shp_code",a.line_code "line_code",a.memo "memo",
    	a.yw_flag "yw_flag",to_char(a.lrrq,'yyyy-MM-dd HH24:mi:ss') "lrrq",a.net_code "net_code",a.dd_flag "dd_flag",a.state "state",a.flag "flag",a.lrr "lrr",a.xgr "xgr",to_char(a.xgrq,'yyyy-MM-dd HH24:mi:ss') "xgrq" ,a.lscar_num "lscar_num",
    	(select b.shp_name from shipper_tab b where b.shp_code=a.shp_code) "shp_name",
    	(select c.line_name from line_tab c where c.line_code=a.line_code) "line_name" ,
    	(select d.net_name from net_tab d where d.net_code=a.net_code) "net_name" ,
    	(select e.peop_name from peop_tab e where e.peop_code=a.lrr) "lrr_name",
    	(select f.peop_name from peop_tab f where f.peop_code=a.xgr) "xgr_name",
    	(select g.name from ywlx_tab g where g.code=a.yw_flag) "ywlx_name" ,
    	(select h.name from cllx_tab h where h.code=a.flag) "cllx_name",
    	(select i.name from taskzt_tab i where i.code=a.state) "state_cn",
    	(case when dd_flag=0 then '提送调度'
    	when dd_flag=1 then '发货调度'
    	END) "dd_flag_cn",a.tsh_peop_code "tsh_peop_code" 
    	from task_tab a
		where a.net_code=#{net_code}
		<if test="lrrq_S != '' and lrrq_S != null">AND a.lrrq&gt;=TO_DATE(#{lrrq_S},'yyyy-MM-dd HH24:mi:ss') </if>
	    <if test="lrrq_E != '' and lrrq_E != null">AND a.lrrq&lt;=TO_DATE(#{lrrq_E},'yyyy-MM-dd HH24:mi:ss') </if> 
		<if test="taskno != '' and taskno != null">AND a.taskno=#{taskno}</if>
		<if test="driver != '' and driver != null">AND driver LIKE CONCAT(CONCAT('%', #{driver}), '%')</if>
		<if test="dd_flag != '' and dd_flag != null">AND dd_flag LIKE CONCAT(CONCAT('%', #{dd_flag}), '%')</if>
		<if test="line_code != '' and line_code != null">AND line_code LIKE CONCAT(CONCAT('%', #{line_code}), '%')</if>
		<if test="car_num != '' and car_num != null">
		AND ((a.car_num LIKE CONCAT(CONCAT('%', #{car_num}), '%')) OR (a.lscar_num LIKE CONCAT(CONCAT('%', #{car_num}), '%')))</if>
		<if test="yw_flag != '' and yw_flag != null">AND yw_flag=#{yw_flag}</if>
		<if test="shp_code != '' and shp_code != null">AND shp_code=#{shp_code}</if>
		<if test="state != '' and state != null">AND state=#{state}</if>
	</select>
	<select id="selectTASKFEE" parameterType="map" resultType="map">
    	select taskno "taskno",tshf "tshf",zcf "zcf",zxf "zxf",tcf "tcf",qtfy "qtfy",gsf "gsf",gxyf "gxyf",totalprice "totalprice"
    	from taskfee_tab
		where 1 = 1
		<if test="taskno != '' and taskno != null">AND taskno LIKE CONCAT(CONCAT('%', #{taskno}), '%')</if>
	</select>
	<select id="selectTASKSS" parameterType="map" resultType="map">
    	select a.state "state",
    	(select i.name from taskzt_tab i where i.code=a.state) "state_cn"
    	from task_tab a
		where 1 = 1
		<if test="taskno != '' and taskno != null">AND a.taskno=#{taskno}</if>
	</select>
	<select id="selectYWLX" parameterType="map" resultType="map">
    	select code "code",name "name",flag "flag"
    	from ywlx_tab 
		where 1 = 1
		<if test="flag != '' and flag != null">AND flag LIKE CONCAT(CONCAT('%', #{flag}), '%')</if>
	</select>
	<select id="selectTASK_RY" parameterType="map" resultType="map">
    	select a.peop_code "peop_code",a.peop_name "peop_name"
   	    from peop_tab a
		where 1 = 1
		<if test="peop_code != '' and peop_code != null">AND peop_code LIKE CONCAT(CONCAT('%', #{peop_code}), '%')</if>
		<if test="peop_name != '' and peop_name != null">AND peop_name LIKE CONCAT(CONCAT('%', #{peop_name}), '%')</if>
		<if test="net_code != '' and net_code != null">AND net_code LIKE CONCAT(CONCAT('%', #{net_code}), '%')</if>
 	</select>
    <select id="selectPCDZT" parameterType="map" resultType="map">
    	select a.code "code",a.name "name",a.flag "flag"
    	from taskzt_tab a
		where 1 = 1
		<if test="flag != '' and flag != null">AND flag LIKE CONCAT(CONCAT('%', #{flag}), '%')</if>
	</select>
	<select id="selectXLXZ" parameterType="map" resultType="map">
        select a.line_code "line_code",a.line_name "line_name",a.fhwd "fhwd",
        (select c.net_name from net_tab c where a.fhwd=c.net_code) "fhwd_name" ,
        (select wm_concat(d.net_name) from lineitem_tab b,net_tab d where b.ddwd_code = d.net_code and a.line_code=b.line_code) "ddwd_name"
        from line_tab a
        where a.flag=0 and EXISTS(select * from lineitem_tab c where a.line_code=c.line_code)
        <if test="line_code != '' and line_code != null">AND a.line_code=#{line_code}</if>
        <if test="fhwd != '' and fhwd != null">AND a.fhwd=#{fhwd}</if>
	</select>
</mapper>